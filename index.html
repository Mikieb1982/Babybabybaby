<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Baby Name Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Architects+Daughter&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Architects Daughter', cursive;
            background-image: url('https://www.transparenttextures.com/patterns/paper.png');
            background-repeat: repeat;
            background-color: #F5F5DC;
            font-size: 1.1rem;
            line-height: 1.7;
            color: #374151;
        }
        input[type="text"], select {
             padding: 0.75rem; border: 1px solid #6B7280; border-radius: 0.5rem; background-color: #fff;
             font-size: 1.1rem; width: 100%; outline: none;
             transition: border-color 0.2s ease, box-shadow 0.2s ease;
             font-family: 'Architects Daughter', cursive;
        }
        input[type="text"]:focus, select:focus { border-color: #60A5FA; box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.3); }
        input:disabled, select:disabled, button:disabled { opacity: 0.6; cursor: not-allowed; }
        input[type=range]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 22px; height: 22px; background: #374151; border-radius: 50%; cursor: pointer; border: 2px solid #FFF; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        input[type=range]::-moz-range-thumb { width: 22px; height: 22px; background: #374151; border-radius: 50%; cursor: pointer; border: 2px solid #FFF; box-shadow: 0 1px 3px rgba(0,0,0,0.2); }
        input[type="radio"] { -webkit-appearance: none; appearance: none; background-color: #fff; margin: 0; font: inherit; color: currentColor; width: 1.2em; height: 1.2em; border: 1px solid #6B7280; border-radius: 50%; transform: translateY(-0.075em); display: inline-grid; place-content: center; cursor: pointer; transition: border-color 0.2s ease; }
        input[type="radio"]::before { content: ""; width: 0.6em; height: 0.6em; border-radius: 50%; transform: scale(0); transition: 120ms transform ease-in-out; box-shadow: inset 1em 1em #475569; }
        input[type="radio"]:checked::before { transform: scale(1); }
        input[type="radio"]:checked { border-color: #475569; }
        input[type="radio"]:focus { outline: none; border-color: #60A5FA; box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.3); }
        select { appearance: none; background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 10 5" fill="%236B7280"%3E%3Cpath d="M0 0l5 5 5-5H0z"/%3E%3C/svg%3E'); background-repeat: no-repeat; background-position: right 0.9em top 50%; background-size: 0.7em auto; cursor: pointer; padding-right: 2.5em; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .fade-in { animation: fadeIn 0.5s ease-in-out forwards; opacity: 0; }
        .result-item, .favorite-item { border-bottom: 1px dashed #94a3b8; padding-bottom: 1rem; margin-bottom: 1rem; }
        .result-item:last-child, .favorite-item:last-child { border-bottom: none; margin-bottom: 0; padding-bottom: 0; }
        .btn { padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: normal; text-align: center; transition: background-color 0.2s ease, transform 0.1s ease, box-shadow 0.2s ease; cursor: pointer; border-width: 1px; box-shadow: 0 1px 2px rgba(0,0,0,0.05); font-size: 1.2rem; }
        .btn:active:not(:disabled) { transform: scale(0.97); }
        .btn-primary { background-color: #374151; border-color: #374151; color: white; }
        .btn-primary:hover:not(:disabled) { background-color: #4b5563; }
        .btn-secondary { background-color: white; border-color: #6B7280; color: #374151; }
        .btn-secondary:hover:not(:disabled) { background-color: #f9fafb; border-color: #4b5563; }
        .btn-icon { padding: 0.5rem; line-height: 1; border: none; background: none; box-shadow: none; }
        #favorites-section { display: none; position: fixed; inset: 0; background-color: rgba(248, 250, 252, 0.9); /* off-white with opacity */ backdrop-filter: blur(4px); padding: 1.5rem; overflow-y: auto; z-index: 50; animation: fadeIn 0.3s ease-out; }
        #favorites-section.active { display: block; }
        .loader { border: 4px solid #e5e7eb; border-top: 4px solid #6b7280; border-radius: 50%; width: 30px; height: 30px; animation: spin 1s linear infinite; margin: 1rem auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
     <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              'soft-beige': '#F5F5DC', 'dark-text': '#374151', 'medium-gray': '#6B7280',
              'button-active': '#60A5FA', 'button-active-hover': '#3B82F6',
              'button-inactive-hover-bg': '#F9FAFB', 'button-inactive-hover-border': '#1F2937',
              'error-red': '#EF4444', 'save-button': '#34D399', 'save-button-hover': '#059669',
              'remove-button': '#F87171', 'remove-button-hover': '#DC2626',
              'copy-button': '#9CA3AF', 'copy-button-hover': '#4B5563',
              'accent-muted': '#64748b', 'accent-muted-light': '#cbd5e1', 'off-white': '#f8fafc',
            }
          }
        }
      }
    </script>
</head>
<body class="p-4 md:p-8">

    <header class="text-center mb-10 relative">
        <a href="index.html" title="Back to Name Generator">
            <img src="assets/stork.png" alt="Minimalist stork drawing" class="mx-auto h-20 w-20 object-contain mb-3" onerror="this.onerror=null; this.src='https://placehold.co/80x80/F5F5DC/374151?text=Stork';">
        </a>
        <h1 class="text-5xl md:text-6xl text-dark-text">
             <a href="index.html" class="hover:text-medium-gray transition-colors">Baby Name Generator</a>
        </h1>
        <p class="text-2xl md:text-3xl text-medium-gray mt-2">Explore names from around the world</p>
        <button id="view-favorites-btn" title="View Favorites" class="absolute top-0 right-0 mt-2 mr-2 md:mt-4 md:mr-4 p-2 rounded-full hover:bg-accent-muted-light transition btn-feedback">
             <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-dark-text" viewBox="0 0 20 20" fill="currentColor"> <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" /> </svg>
        </button>
    </header>

    <hr class="border-t border-dashed border-accent-muted-light max-w-4xl mx-auto my-10 md:my-14">

    <main class="max-w-3xl mx-auto bg-off-white p-6 md:p-10 rounded-lg border-2 border-dark-text shadow-sm">

        <fieldset id="generator-controls" class="space-y-8 md:space-y-10 mb-10">
             <legend class="sr-only">Name Generation Controls</legend>

             <section id="gender-selection">
                <label class="block text-2xl md:text-3xl text-dark-text mb-4">Gender:</label>
                <div class="flex flex-wrap gap-x-8 gap-y-3">
                    <div class="flex items-center"> <input type="radio" id="gender-any" name="gender" value="any" checked class="mr-2.5"> <label for="gender-any" class="text-xl md:text-2xl cursor-pointer">Any</label> </div>
                    <div class="flex items-center"> <input type="radio" id="gender-boy" name="gender" value="boy" class="mr-2.5"> <label for="gender-boy" class="text-xl md:text-2xl cursor-pointer">Boy</label> </div>
                    <div class="flex items-center"> <input type="radio" id="gender-girl" name="gender" value="girl" class="mr-2.5"> <label for="gender-girl" class="text-xl md:text-2xl cursor-pointer">Girl</label> </div>
                </div>
            </section>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 md:gap-8">
                <section id="language-selection">
                    <label for="language-select" class="block text-2xl md:text-3xl text-dark-text mb-3">Language/Origin:</label>
                    <select id="language-select" name="language" class="text-xl"> <option value="">Loading Languages...</option> </select>
                </section>
                <section id="letter-filter">
                    <label for="first-letter-input" class="block text-2xl md:text-3xl text-dark-text mb-3">Starts with:</label>
                    <input type="text" id="first-letter-input" maxlength="1" placeholder="Any Letter" class="text-xl">
                </section>
            </div>

            <section id="length-filter">
                <label class="block text-2xl md:text-3xl text-dark-text mb-4">Name Length:</label>
                <div class="flex flex-wrap gap-x-8 gap-y-3">
                    <div class="flex items-center"> <input type="radio" id="length-any" name="length" value="any" checked class="mr-2.5"> <label for="length-any" class="text-xl md:text-2xl cursor-pointer">Any</label> </div>
                    <div class="flex items-center"> <input type="radio" id="length-short" name="length" value="short" class="mr-2.5"> <label for="length-short" class="text-xl md:text-2xl cursor-pointer">Short (&lt;5)</label> </div>
                    <div class="flex items-center"> <input type="radio" id="length-medium" name="length" value="medium" class="mr-2.5"> <label for="length-medium" class="text-xl md:text-2xl cursor-pointer">Medium (5-7)</label> </div>
                    <div class="flex items-center"> <input type="radio" id="length-long" name="length" value="long" class="mr-2.5"> <label for="length-long" class="text-xl md:text-2xl cursor-pointer">Long (&gt;7)</label> </div>
                </div>
            </section>

             <section id="style-slider">
                <div class="flex justify-between items-center mb-3">
                    <h2 class="text-2xl md:text-3xl text-dark-text">Name Style:</h2>
                    <span id="slider-feedback" class="text-medium-gray text-lg md:text-xl">Balanced</span>
                </div>
                <div class="flex items-center justify-between text-medium-gray mb-4 text-lg md:text-xl">
                    <span>Traditional</span>
                    <span>Unique</span>
                </div>
                <input id="style-range" type="range" min="0" max="100" value="50" class="w-full h-2 bg-accent-muted-light rounded-lg appearance-none cursor-pointer">
            </section>

        </fieldset>

          <section id="generate-button-section" class="text-center my-10 md:my-12">
             <button id="generate-btn" class="btn btn-primary text-2xl md:text-3xl shadow-sm">
                Generate Name
            </button>
         </section>

        <hr class="border-t border-dashed border-accent-muted-light my-8 md:my-10">

        <section id="name-display" class="bg-off-white p-6 rounded-lg border border-medium-gray min-h-[150px]">
             <h2 class="text-3xl md:text-4xl text-dark-text mb-5">Generated Name:</h2>
            <div id="name-output" class="text-left space-y-4 text-xl relative">
                 <p id="initial-message" class="text-medium-gray italic text-center text-xl">Select options and click "Generate Name"!</p>
            </div>
        </section>

         <section id="favorites-section" class="mt-10 p-6 border border-medium-gray rounded-lg bg-off-white">
            <div class="flex flex-wrap justify-between items-center gap-4 mb-5">
                <h2 class="text-3xl md:text-4xl text-dark-text">Saved Favorites</h2>
                <div class="flex items-center gap-4">
                     <button id="sort-favorites-btn" class="text-lg text-dark-text hover:text-accent-muted transition-colors underline btn-feedback">Sort A-Z</button>
                    <button id="clear-favorites-btn" class="text-lg text-remove-button hover:text-remove-button-hover transition-colors underline btn-feedback">Clear All</button>
                </div>
            </div>
            <div id="favorites-list" class="space-y-4">
                <p id="no-favorites-message" class="text-medium-gray italic text-center text-xl">Your saved names will appear here!</p>
            </div>
        </section>

    </main>

     <hr class="border-t border-dashed border-accent-muted-light max-w-4xl mx-auto my-10 md:my-14">

    <footer class="text-center text-medium-gray text-xl space-y-2">
        <p>&copy; 2025 Baby Name Generator. All rights reserved.</p>
        <p><a href="blog.html" class="hover:text-dark-text underline">Naming Tips & Ideas Blog</a></p>
    </footer>

    {/* Favorites Modal/Panel - Kept separate for clarity */}
    <aside id="favorites-panel" style="display: none;" class="fixed inset-0 bg-soft-beige bg-opacity-95 backdrop-blur-sm p-6 md:p-10 overflow-y-auto z-50">
        <div class="max-w-2xl mx-auto bg-off-white p-6 md:p-8 rounded-lg border-2 border-dark-text shadow-lg relative">
            <button id="close-favorites-btn" title="Close Favorites" class="absolute top-3 right-3 p-1.5 rounded-full hover:bg-accent-muted-light transition btn-feedback">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7 text-dark-text" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"> <path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /> </svg>
            </button>
            <h2 class="text-3xl md:text-4xl text-dark-text mb-8 text-center">Favorite Names</h2>
            <div id="favorites-panel-list" class="space-y-6">
                <p id="favorites-panel-placeholder" class="text-center text-medium-gray text-xl italic">No favorites saved yet.</p>
                 {/* Favorites will be listed here */}
            </div>
        </div>
    </aside>


    <script>
        // ===========================================
        // DATA SOURCE (SAMPLE - NEEDS EXPANSION!)
        // ===========================================
        // FOR PREVIEW/TESTING ONLY. Replace with fetch('names.json') in production.
        const nameData = [
            { id: 'en1', name: "William", language: "english", gender: "boy", meaning: "Resolute protector.", originNotes: "Germanic roots, English royalty", pronunciation: "WIL-ee-uhm", popularity: "Classic", lengthCategory: "medium", styleScore: 10 },
            { id: 'en2', name: "Olivia", language: "english", gender: "girl", meaning: "Olive tree.", originNotes: "Latin origin, via Shakespeare", pronunciation: "oh-LIV-ee-uh", popularity: "Top 100", lengthCategory: "medium", styleScore: 20 },
            { id: 'en4', name: "Isla", language: "english", gender: "girl", meaning: "Island.", originNotes: "Scottish river/island name", pronunciation: "EYE-luh", popularity: "Rising Trend", lengthCategory: "short", styleScore: 40 },
            { id: 'de1', name: "Maximilian", language: "german", gender: "boy", meaning: "Greatest.", originNotes: "Latin origin, popular in Germany", pronunciation: "mak-see-MEE-lee-ahn", popularity: "Classic", lengthCategory: "long", styleScore: 25 },
            { id: 'fr1', name: "Louis", language: "french", gender: "boy", meaning: "Famous warrior.", originNotes: "Germanic roots, French royalty", pronunciation: "LOO-ee / LWEE", popularity: "Classic", lengthCategory: "short", styleScore: 10 },
            { id: 'jp1', name: "Haruto", language: "japanese", gender: "boy", meaning: "Sun flying / Clear weather person", originNotes: "Kanji dependent meaning", pronunciation: "ha-ROO-toh", popularity: "Popular (Japan)", lengthCategory: "medium", styleScore: 30 },
            { id: 'jp6', name: "Sakura", language: "japanese", gender: "girl", meaning: "Cherry blossom.", originNotes: "Iconic Japanese flower name", pronunciation: "SAH-koo-rah", popularity: "Classic", lengthCategory: "medium", styleScore: 10 }
            // Add MANY more names here...
        ];
        // Pre-calculate length category for embedded data
        nameData.forEach(item => { item.lengthCategory = getLengthCategory(item.name); });
        let nameDatabase = nameData; // Use embedded data for preview
        let dataLoaded = true; // Assume data is loaded since it's embedded

        // ===========================================
        // DOM Elements
        // ===========================================
        const controlsFieldset = document.getElementById('generator-controls');
        const genderRadios = document.querySelectorAll('input[name="gender"]');
        const languageSelect = document.getElementById('language-select');
        const lengthRadios = document.querySelectorAll('input[name="length"]');
        const firstLetterInput = document.getElementById('first-letter-input');
        const styleSlider = document.getElementById('style-range');
        const generateBtn = document.getElementById('generate-btn');
        const nameOutput = document.getElementById('name-output');
        const initialMessage = document.getElementById('initial-message'); // Reference initial message
        const sliderFeedback = document.getElementById('slider-feedback');
        const viewFavoritesBtn = document.getElementById('view-favorites-btn');
        const favoritesPanel = document.getElementById('favorites-panel'); // Changed ID
        const favoritesPanelList = document.getElementById('favorites-panel-list'); // Changed ID
        const favoritesPanelPlaceholder = document.getElementById('favorites-panel-placeholder'); // Changed ID
        const closeFavoritesBtn = document.getElementById('close-favorites-btn'); // Close button
        // Note: Sort/Clear buttons would typically be inside the panel now
        // Let's assume they are for now, or add them if needed. We'll handle display logic.

        // ===========================================
        // State Variables
        // ===========================================
        let selectedGender = 'any';
        let selectedLanguage = ''; // Will be set after languages load/populate
        let selectedLength = 'any';
        let selectedFirstLetter = '';
        let selectedStyle = 50;
        let currentDisplayedName = null;
        let favorites = [];
        let favoritesSortAsc = true; // Assuming sort/clear are inside the panel

        // ===========================================
        // Helper Functions
        // ===========================================
        function getStyleCategory(value) { if (value < 20) return 'Very Traditional'; if (value < 40) return 'Traditional'; if (value < 61) return 'Balanced'; if (value < 81) return 'Unique'; return 'Very Unique'; }
        function updateSliderFeedback() { sliderFeedback.textContent = getStyleCategory(selectedStyle); }
        function copyToClipboard(text, buttonElement) { navigator.clipboard.writeText(text).then(() => { const originalHTML = buttonElement.innerHTML; buttonElement.innerHTML = 'Copied!'; buttonElement.classList.add('text-save-button'); buttonElement.disabled = true; setTimeout(() => { buttonElement.innerHTML = originalHTML; buttonElement.classList.remove('text-save-button'); buttonElement.disabled = false; }, 1500); }).catch(err => { console.error('Failed to copy text: ', err); const originalHTML = buttonElement.innerHTML; buttonElement.innerHTML = 'Error'; buttonElement.classList.add('text-error-red'); setTimeout(() => { buttonElement.innerHTML = originalHTML; buttonElement.classList.remove('text-error-red'); }, 1500); }); }
        function getLengthCategory(name) { const len = name.length; if (len < 5) return 'short'; if (len <= 7) return 'medium'; return 'long'; }

        // ===========================================
        // Favorites Functions (localStorage)
        // ===========================================
        function loadFavorites() { const storedFavorites = localStorage.getItem('babyNameFavorites'); if (storedFavorites) { favorites = JSON.parse(storedFavorites); } else { favorites = []; } console.log('Favorites loaded:', favorites); }
        function saveFavorites() { localStorage.setItem('babyNameFavorites', JSON.stringify(favorites)); console.log('Favorites saved:', favorites); }
        function isFavorite(nameObj) { return nameObj ? favorites.some(fav => fav.id === nameObj.id) : false; }
        function addToFavorites(nameObj) { if (nameObj && !isFavorite(nameObj)) { favorites.push(nameObj); saveFavorites(); renderSaveButton(document.getElementById(`save-btn-container-${nameObj.id}`), nameObj, true); console.log('Added to favorites:', nameObj); } }
        function removeFromFavorites(nameId) { favorites = favorites.filter(fav => fav.id !== nameId); saveFavorites(); displayFavoritesInPanel(); if (currentDisplayedName && currentDisplayedName.id === nameId) { renderSaveButton(document.getElementById(`save-btn-container-${nameId}`), currentDisplayedName, false); } console.log('Removed favorite with ID:', nameId); }

        // Updated displayFavorites for Panel
        function displayFavoritesInPanel() {
            favorites.sort((a, b) => { const nameA = a.name.toLowerCase(); const nameB = b.name.toLowerCase(); if (nameA < nameB) return favoritesSortAsc ? -1 : 1; if (nameA > nameB) return favoritesSortAsc ? 1 : -1; return 0; });
            favoritesPanelList.innerHTML = ''; // Clear current list in panel
            favoritesPanelPlaceholder.style.display = favorites.length === 0 ? 'block' : 'none';

            if (favorites.length > 0) {
                 // Add Sort/Clear buttons dynamically if needed, or assume they are static HTML in the panel
                 // Example: Add clear button if list not empty
                 const clearAllBtn = document.createElement('button');
                 clearAllBtn.textContent = 'Clear All Favorites';
                 clearAllBtn.className = 'block mx-auto text-lg text-remove-button hover:text-remove-button-hover transition-colors underline btn-feedback mb-6';
                 clearAllBtn.onclick = () => { if (confirm('Are you sure?')) { favorites = []; saveFavorites(); displayFavoritesInPanel(); if (currentDisplayedName) renderSaveButton(document.getElementById(`save-btn-container-${currentDisplayedName.id}`), currentDisplayedName, false); }};
                 favoritesPanelList.appendChild(clearAllBtn);
            }


            favorites.forEach(fav => {
                const itemDiv = document.createElement('div'); itemDiv.className = 'favorite-item flex flex-col sm:flex-row justify-between sm:items-start py-4 gap-3';
                const textDiv = document.createElement('div');
                textDiv.innerHTML = `<strong class="text-2xl block">${fav.name}</strong> <span class="text-lg text-medium-gray block">${fav.meaning || ''}</span> <span class="text-base text-gray-500 block mt-1"> Origin: ${fav.originNotes || fav.language} &bull; Pronunciation: ${fav.pronunciation || 'N/A'} &bull; Popularity: ${fav.popularity || 'N/A'} </span>`;
                const buttonsDiv = document.createElement('div'); buttonsDiv.className = 'flex items-center gap-3 mt-2 sm:mt-0 flex-shrink-0';
                const copyBtn = document.createElement('button'); copyBtn.title = 'Copy Info'; copyBtn.className = 'btn-icon text-copy-button hover:text-copy-button-hover transition-colors btn-feedback';
                copyBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>`;
                copyBtn.onclick = (e) => { const textToCopy = `Name: ${fav.name}\nMeaning: ${fav.meaning || 'N/A'}\nOrigin: ${fav.originNotes || fav.language}\nPronunciation: ${fav.pronunciation || 'N/A'}\nPopularity: ${fav.popularity || 'N/A'}`; copyToClipboard(textToCopy, e.currentTarget); };
                const removeBtn = document.createElement('button'); removeBtn.title = 'Remove from Favorites'; removeBtn.className = 'btn-icon text-remove-button hover:text-remove-button-hover transition-colors btn-feedback'; removeBtn.dataset.id = fav.id;
                 removeBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>`;
                 removeBtn.onclick = () => removeFromFavorites(fav.id); // Call remove function
                buttonsDiv.appendChild(copyBtn); buttonsDiv.appendChild(removeBtn); itemDiv.appendChild(textDiv); itemDiv.appendChild(buttonsDiv); favoritesPanelList.appendChild(itemDiv);
            });
        }

        function toggleFavoritesPanel() {
             if (favoritesPanel.style.display === 'block') {
                 favoritesPanel.style.display = 'none';
             } else {
                 displayFavoritesInPanel(); // Update content before showing
                 favoritesPanel.style.display = 'block';
             }
         }

        // Renders the save button
        function renderSaveButton(container, nameObj, isSaved) {
             if (!container) return; container.innerHTML = ''; const saveBtn = document.createElement('button');
            saveBtn.title = isSaved ? 'Saved to Favorites' : 'Save to Favorites'; saveBtn.disabled = isSaved;
            saveBtn.className = `save-btn btn-icon transition-colors btn-feedback ${ isSaved ? 'text-save-button cursor-not-allowed' : 'text-medium-gray hover:text-save-button' }`;
            saveBtn.dataset.id = nameObj.id;
            saveBtn.innerHTML = isSaved ? `<svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" /></svg>`
                                        : `<svg xmlns="http://www.w3.org/2000/svg" class="h-7 w-7" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z" /></svg>`;
            if (!isSaved) { saveBtn.onclick = () => { addToFavorites(nameObj); }; } container.appendChild(saveBtn);
        }

        // ===========================================
        // Data Loading Function (Using Embedded Data for Preview)
        // ===========================================
        function loadAndPrepareData() {
            console.log('Using embedded sample data for preview.');
            // Add lengthCategory to data if missing
            nameDatabase.forEach(item => {
                if (!item.lengthCategory) { item.lengthCategory = getLengthCategory(item.name); }
            });

            // Populate language dropdown
            const languages = [...new Set(nameDatabase.map(item => item.language))].sort();
            languageSelect.innerHTML = ''; // Clear loading message
            // Add "Any Language" option first
             const anyOption = document.createElement('option');
             anyOption.value = "any";
             anyOption.textContent = "Any Language";
             languageSelect.appendChild(anyOption);
            // Add specific languages
            languages.forEach(lang => {
                const option = document.createElement('option');
                option.value = lang; // Use language code/name as value
                option.textContent = lang.charAt(0).toUpperCase() + lang.slice(1); // Capitalize
                languageSelect.appendChild(option);
            });
            selectedLanguage = languageSelect.value; // Set initial language state to 'any'

            // Enable controls
            controlsFieldset.disabled = false;
            generateBtn.disabled = false;
            dataLoaded = true;
            // Remove loading message if present, show initial prompt
            const loadingMsg = document.getElementById('loading-message');
            if(loadingMsg) loadingMsg.remove();
            if(initialMessage) initialMessage.style.display = 'block'; // Show initial prompt
            console.log("Data ready, controls enabled.");
        }


        // ===========================================
        // Event Listeners Setup
        // ===========================================
        function setupEventListeners() {
            genderRadios.forEach(radio => { radio.addEventListener('change', (event) => { selectedGender = event.target.value; }); });
            languageSelect.addEventListener('change', (event) => { selectedLanguage = event.target.value; });
            lengthRadios.forEach(radio => { radio.addEventListener('change', (event) => { selectedLength = event.target.value; }); });
            firstLetterInput.addEventListener('input', (event) => { selectedFirstLetter = event.target.value.trim(); });
            styleSlider.addEventListener('input', (event) => { selectedStyle = parseInt(event.target.value); updateSliderFeedback(); });

            // Generate Button Click
             generateBtn.addEventListener('click', () => {
                if (!dataLoaded) return;
                console.log(`Generating name: G=${selectedGender}, L=${selectedLanguage}, Len=${selectedLength}, FL='${selectedFirstLetter}', Sty=${selectedStyle}`);
                nameOutput.innerHTML = `<div class="flex justify-center items-center h-full"><div class="loader"></div><p class="text-dark-text ml-3 text-xl">Thinking...</p></div>`;
                currentDisplayedName = null;
                initialMessage.style.display = 'none'; // Hide initial message

                const targetStyleCategory = getStyleCategory(selectedStyle);

                // Filter names
                const filteredNames = nameDatabase.filter(item => {
                    const languageMatch = selectedLanguage === 'any' || item.language === selectedLanguage; // Handle 'any' language
                    const genderMatch = selectedGender === 'any' || item.gender === selectedGender || item.gender === 'any';
                    const itemStyleCategory = getStyleCategory(item.styleScore);
                    const styleMatch = itemStyleCategory === targetStyleCategory;
                    const letterMatch = selectedFirstLetter === '' || item.name.toLowerCase().startsWith(selectedFirstLetter.toLowerCase());
                    const lengthMatch = selectedLength === 'any' || item.lengthCategory === selectedLength;
                    return languageMatch && genderMatch && styleMatch && letterMatch && lengthMatch;
                });
                console.log('Filtered Names Count:', filteredNames.length);

                // Display single result
                setTimeout(() => {
                    nameOutput.innerHTML = ''; // Clear loading
                    if (filteredNames.length > 0) {
                        const randomIndex = Math.floor(Math.random() * filteredNames.length);
                        currentDisplayedName = filteredNames[randomIndex];
                        console.log('Selected Name:', currentDisplayedName);

                        const resultDiv = document.createElement('div');
                        resultDiv.className = 'result-item fade-in relative';
                        const textDiv = document.createElement('div');
                         // Adjusted text sizes and layout for better readability
                        textDiv.innerHTML = `
                            <h3 class="text-5xl text-dark-text mb-2">${currentDisplayedName.name}</h3>
                            <p class="text-xl text-dark-text mb-2">${currentDisplayedName.meaning || 'Meaning not available.'}</p>
                            <p class="text-lg text-medium-gray">
                                <span class="font-semibold">Origin:</span> ${currentDisplayedName.originNotes || currentDisplayedName.language} <br>
                                <span class="font-semibold">Pronunciation:</span> ${currentDisplayedName.pronunciation || 'N/A'} <br>
                                <span class="font-semibold">Popularity:</span> ${currentDisplayedName.popularity || 'N/A'}
                            </p>
                            <p class="text-base text-gray-500 mt-2"> (Style: ${getStyleCategory(currentDisplayedName.styleScore)}) </p>
                        `;
                        const buttonsDiv = document.createElement('div');
                        buttonsDiv.className = 'absolute top-1 right-1 flex items-center gap-2';
                        const saveBtnContainer = document.createElement('div');
                        saveBtnContainer.id = `save-btn-container-${currentDisplayedName.id}`;
                        renderSaveButton(saveBtnContainer, currentDisplayedName, isFavorite(currentDisplayedName));
                        const copyBtn = document.createElement('button');
                        copyBtn.title = 'Copy Info';
                        copyBtn.className = 'btn-icon text-copy-button hover:text-copy-button-hover transition-colors btn-feedback';
                        copyBtn.innerHTML = `<svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" /></svg>`;
                        copyBtn.onclick = (e) => { const textToCopy = `Name: ${currentDisplayedName.name}\nMeaning: ${currentDisplayedName.meaning || 'N/A'}\nOrigin: ${currentDisplayedName.originNotes || currentDisplayedName.language}\nPronunciation: ${currentDisplayedName.pronunciation || 'N/A'}\nPopularity: ${currentDisplayedName.popularity || 'N/A'}`; copyToClipboard(textToCopy, e.currentTarget); };
                        buttonsDiv.appendChild(saveBtnContainer);
                        buttonsDiv.appendChild(copyBtn);
                        resultDiv.appendChild(textDiv);
                        resultDiv.appendChild(buttonsDiv);
                        nameOutput.appendChild(resultDiv);
                    } else {
                        console.log('No names found matching criteria.');
                        nameOutput.innerHTML = `<p class="text-error-red italic error-message text-xl text-center">No matching names found this time! Maybe try adjusting the Style slider or removing the first letter?</p>`;
                        currentDisplayedName = null;
                    }
                }, 300);
            });

            // Favorites Panel Interaction
            favoritesPanelList.addEventListener('click', (event) => {
                 const removeButton = event.target.closest('button[title="Remove from Favorites"]'); // More specific selector
                 if (removeButton && removeButton.dataset.id) {
                     removeFromFavorites(removeButton.dataset.id);
                 }
             });
            viewFavoritesBtn.addEventListener('click', toggleFavoritesPanel);
            closeFavoritesBtn.addEventListener('click', toggleFavoritesPanel); // Use the same toggle function

            // Add listener for Clear All if it's dynamically added or ensure it exists in HTML
            // Assuming Clear All button might be added dynamically in displayFavoritesInPanel
            favoritesPanelList.addEventListener('click', (event) => {
                 if (event.target.id === 'clear-all-favs-btn') { // Example ID if added dynamically
                    if (confirm('Are you sure?')) { favorites = []; saveFavorites(); displayFavoritesInPanel(); if (currentDisplayedName) renderSaveButton(document.getElementById(`save-btn-container-${currentDisplayedName.id}`), currentDisplayedName, false); }
                 }
            });

             // Add listener for Sort if added dynamically or ensure it exists
             // Example assuming static button for sort (if we add one)
             // const sortBtn = document.getElementById('sort-favorites-btn');
             // if(sortBtn) { sortBtn.addEventListener('click', () => { favoritesSortAsc = !favoritesSortAsc; sortBtn.textContent = favoritesSortAsc ? 'Sort A-Z' : 'Sort Z-A'; displayFavoritesInPanel(); });}

        }

        // ===========================================
        // Initial Page Load
        // ===========================================
        document.addEventListener('DOMContentLoaded', () => {
             loadFavorites();
             loadAndPrepareData(); // Use embedded data for preview
             updateSliderFeedback();
             setupEventListeners();
             favoritesPanel.style.display = 'none'; // Ensure panel hidden initially
        });
    </script>

</body>
</html>

I've removed the comments from the HTML and the main JavaScript logic. I left the section headers in the script (// === ... ===) as they help structure the significantly larger code block.
